import{S as X,i as Q,s as Z,e as E,k as F,t as q,K as ee,c as P,d as S,m as Y,a as W,h as x,b as k,L as te,J as m,g as H,n as V,w as se}from"../chunks/index-d1583acf.js";import{p as ae,b as le,a as ne,c as oe}from"../chunks/index-84de4434.js";function ie(v){let r,C,w,T,G,M,B,O,_,A,z,D,U,e,y,l,s,n,c,a;return{c(){r=E("meta"),C=F(),w=E("section"),T=E("h1"),G=E("span"),M=E("picture"),B=E("source"),O=F(),_=E("img"),z=q(`

		to your new`),D=E("br"),U=q("SvelteKit app"),e=F(),y=E("h2"),l=q("try editing "),s=E("strong"),n=q("src/routes/index.svelte"),c=F(),a=E("div"),this.h()},l(t){const u=ee('[data-svelte="svelte-t32ptj"]',document.head);r=P(u,"META",{name:!0,content:!0}),u.forEach(S),C=Y(t),w=P(t,"SECTION",{class:!0});var h=W(w);T=P(h,"H1",{class:!0});var o=W(T);G=P(o,"SPAN",{class:!0});var I=W(G);M=P(I,"PICTURE",{});var i=W(M);B=P(i,"SOURCE",{srcset:!0,type:!0}),O=Y(i),_=P(i,"IMG",{src:!0,alt:!0,class:!0}),i.forEach(S),I.forEach(S),z=x(o,`

		to your new`),D=P(o,"BR",{}),U=x(o,"SvelteKit app"),o.forEach(S),e=Y(h),y=P(h,"H2",{});var g=W(y);l=x(g,"try editing "),s=P(g,"STRONG",{});var f=W(s);n=x(f,"src/routes/index.svelte"),f.forEach(S),g.forEach(S),h.forEach(S),c=Y(t),a=P(t,"DIV",{id:!0,class:!0}),W(a).forEach(S),this.h()},h(){document.title="Home",k(r,"name","description"),k(r,"content","Svelte demo app"),k(B,"srcset","svelte-welcome.webp"),k(B,"type","image/webp"),te(_.src,A="svelte-welcome.png")||k(_,"src",A),k(_,"alt","Welcome"),k(_,"class","svelte-1na84fd"),k(G,"class","welcome svelte-1na84fd"),k(T,"class","svelte-1na84fd"),k(w,"class","svelte-1na84fd"),k(a,"id","mapid"),k(a,"class","svelte-1na84fd")},m(t,u){m(document.head,r),H(t,C,u),H(t,w,u),m(w,T),m(T,G),m(G,M),m(M,B),m(M,O),m(M,_),m(T,z),m(T,D),m(T,U),m(w,e),m(w,y),m(y,l),m(y,s),m(s,n),H(t,c,u),H(t,a,u)},p:V,i:V,o:V,d(t){S(r),t&&S(C),t&&S(w),t&&S(c),t&&S(a)}}}const de=!0;function K(v){return v>1024*1024?(v/1024/104).toFixed(0)+" MB":v>1024?(v/1024).toFixed(0)+" kB":v+" B"}function J(v){return v>1e3?(bytes/1e3).toFixed(0)+" s":v+" ms"}function re(v){let r;return se(async()=>{r=L.map("mapid").setView([65.33,26.818],176),L.tileLayer("https://tiles.kartat.kapsi.fi/peruskartta/{z}/{x}/{y}.jpg",{attribution:"&copy; MML"}).addTo(r),L.tileLayer("//tile.waymarkedtrails.org/hiking/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://waymarkedtrails.org">Waymarked Trails</a>'}).addTo(r);let C=null;const w=.016,T=.016,G="api-key=468d361d-0f46-4cde-b8af-9c125302d6d4",M=L.GridLayer.extend({id2way:{},createTile(e,y){const l=L.DomUtil.create("canvas","leaflet-tile"),s=this.getTileSize();l.width=s.x,l.height=s.y;const n=r.unproject(e.scaleBy(s),e.z),c=r.unproject(e.clone().add([1,1]).scaleBy(s),e.z),a=L.latLngBounds(n,c),t=a.getEast()-a.getWest(),u=a.getNorth()-a.getSouth(),h="https://avoin-paikkatieto.maanmittauslaitos.fi/maastotiedot/features/v1/collections/",o=l.getContext("2d");o.clearRect(0,0,l.width,l.height);const I="korkeuskayra,jarvi,rakennus".split(",");for(const i of I)fetch(`${h}${i}/items?${G}&bbox=${n.lng},${c.lat},${c.lng},${n.lat}&&bbox-crs=http://www.opengis.net/def/crs/EPSG/0/4326&crs=http://www.opengis.net/def/crs/EPSG/0/4326&f=json`).then(g=>{const f=Date.now();g.json().then(d=>{for(const b of d.features){if(i=="jarvi"){o.beginPath();for(let p=0;p<b.geometry.coordinates[0].length;p++){const N=b.geometry.coordinates[0][p],$=(N[0]-a.getWest())/t*s.x,R=s.y-(N[1]-a.getSouth())/u*s.y;p==0?o.moveTo($,R):o.lineTo($,R)}o.closePath(),o.fillStyle="blue",o.fill()}if(i=="korkeuskayra"){for(let p=0;p<b.geometry.coordinates.length;p++){const N=b.geometry.coordinates[p],$=(N[0]-a.getWest())/t*s.x,R=s.y-(N[1]-a.getSouth())/u*s.y;p==0?o.moveTo($,R):o.lineTo($,R)}o.lineWidth=.4,o.strokeStyle="white",o.stroke()}}const j=Date.now();console.log("rt",i,K(JSON.stringify(d).length),J(j-f)),y(void 0,l)})});return l}}),B=L.GridLayer.extend({renderSoil(e,y,l,s,n){switch(e.fillStyle="magenta",y){case 1:switch(e.fillStyle="LimeGreen",l){case 1:e.fillStyle="LimeGreen";break;case 2:e.fillStyle="MediumSeaGreen";break;case 3:e.fillStyle="DarkSeaGreen";break;case 4:e.fillStyle="YellowGreen";break;case 5:e.fillStyle="DarkKhaki";break}break;case 2:e.fillStyle="orange";break;case 3:e.fillStyle="brown";break;case 4:break;case 5:break;case 6:e.fillStyle="yellow";break;case 7:break;case 8:e.fillStyle="blue";break}switch(n&&(e.fillStyle="yellow"),l){case 1:e.fillStyle="LimeGreen";break;case 2:e.fillStyle="#9ABD53";break;case 3:e.fillStyle="YellowGreen";break;case 4:e.fillStyle="Gold";break;case 5:e.fillStyle="Aquamarine";break}e.fill()},renderTrees(e,y,l,s){const n=y,c=n.getEast()-n.getWest(),a=n.getNorth()-n.getSouth();for(const t of s){const u=t.pt,h=(u[0]-n.getWest())/c*l.x,o=l.y-(u[1]-n.getSouth())/a*l.y;switch(e.beginPath(),e.moveTo(h-Math.max(t.height/7,1),o),e.lineTo(h,o-Math.max(t.height,3)),e.lineTo(h+Math.max(t.height/7,1),o),e.closePath(),e.fillStyle="brown",e.fill(),t.specie){case 1:e.beginPath(),e.arc(h,o-t.height*.7,t.height/2,Math.PI*.8,Math.PI*.2),e.closePath(),e.fillStyle="ForestGreen",e.fill();break;case 2:e.beginPath(),e.moveTo(h-t.height/3,o-2),e.lineTo(h,o-t.height),e.lineTo(h+t.height/3,o-2),e.closePath(),e.fillStyle="ForestGreen",e.fill();break;case 3:case 4:e.fillStyle="LightYellow",e.fill(),e.beginPath(),e.arc(h,o-t.height*1,t.height/3,Math.PI*.85,Math.PI*.15),e.arc(h,o-t.height*.6,t.height/2.5,Math.PI*.85,Math.PI*.15),e.closePath(),e.fillStyle="GreenYellow",e.fill();break;case 5:e.fillStyle="DarkGray",e.fill(),e.beginPath(),e.arc(h,o-t.height*1,t.height/3,Math.PI*.85,Math.PI*.15),e.arc(h,o-t.height*.6,t.height/2.5,Math.PI*.85,Math.PI*.15),e.closePath(),e.fillStyle="DarkGreen",e.fill();break}}},addTrees(e,y){const l=e.properties,s=ae(e.geometry.coordinates,e.properties),n=l.STEMCOUNT>0?Math.sqrt(l.AREA/l.STEMCOUNT):1e4;e.freq=n;const c=le(s);let a={x:c[1],y:c[2]};for(;a.y>c[0];){const t=ne([a.y,a.x]);oe(t,s)&&y.push({pt:t.geometry.coordinates,height:l.MEANHEIGHT,specie:l.MAINTREESPECIES}),a.x+=n*w,a.x>c[3]&&(a.y-=n*T,a.x-=c[3]-[c[1]])}},createTile(e,y){const l=[],s=L.DomUtil.create("canvas","leaflet-tile"),n=this.getTileSize();s.width=n.x,s.height=n.y;const c=r.unproject(e.scaleBy(n),e.z),a=r.unproject(e.clone().add([1,1]).scaleBy(n),e.z),t=L.latLngBounds(c,a),u=t.getEast()-t.getWest(),h=t.getNorth()-t.getSouth();return fetch(`https://rajapinnat.metsaan.fi/geoserver/Avoinmetsatieto/stand/wfs?SERVICE=WFS&REQUEST=GetFeature&VERSION=2.0.0&TYPENAMES=Avoinmetsatieto:stand&STARTINDEX=0&COUNT=10000&SRSNAME=urn:ogc:def:crs:EPSG::4326&BBOX=${t.getSouth()},${t.getWest()},${t.getNorth()},${t.getEast()},urn:ogc:def:crs:EPSG::4326&outputFormat=json`).then(I=>{I.json().then(i=>{const g=Date.now(),f=s.getContext("2d");f.clearRect(0,0,s.width,s.height);for(const d of i.features){this.addTrees(d,l),f.beginPath();for(let b=0;b<d.geometry.coordinates[0].length;b++){const p=d.geometry.coordinates[0][b],N=(p[0]-t.getWest())/u*n.x,$=n.y-(p[1]-t.getSouth())/h*n.y;b==0?f.moveTo(N,$):f.lineTo(N,$)}f.closePath();const j=d.properties;this.renderSoil(f,j.MAINGROUP,j.SUBGROUP,j.SOILTYPE,d==C),f.lineWidth=.3,f.strokeStyle="black",f.stroke()}this.renderTrees(f,t,n,l),console.log("mk",K(JSON.stringify(i).length),J(Date.now()-g)),y(void 0,s)})}),s}});new B().addTo(r),new M().addTo(r);const A=L.GridLayer.extend({id2way:{},createTile(e,y){const l=L.DomUtil.create("canvas","leaflet-tile"),s=this.getTileSize();l.width=s.x,l.height=s.y;const n=r.unproject(e.scaleBy(s),e.z),c=r.unproject(e.clone().add([1,1]).scaleBy(s),e.z),a=L.latLngBounds(n,c),t=a.getEast()-a.getWest(),u=a.getNorth()-a.getSouth();return fetch(`https://overpass.kumi.systems/api/interpreter?data=[out:json][bbox:${c.lat},${n.lng},${n.lat},${c.lng}];way[highway];out geom;`).then(o=>{o.json().then(I=>{for(const g of I.elements){const f=g.id;this.id2way[f]===void 0&&(this.id2way[f]=g)}const i=l.getContext("2d");i.clearRect(0,0,l.width,l.height);for(const g of Object.values(this.id2way)){const f=L.latLngBounds(L.latLng(g.bounds.minlat,g.bounds.minlon),L.latLng(g.bounds.maxlat,g.bounds.maxlon));if(a.overlaps(f)){i.beginPath();for(let d=0;d<g.geometry.length;d++){const j=g.geometry[d],b=(j.lon-a.getWest())/t*s.x,p=s.y-(j.lat-a.getSouth())/u*s.y;d==0?i.moveTo(b,p):i.lineTo(b,p)}if(g.tags.highway=="path"){if(g.tags["mtb:scale"]){let d=null;switch(parseInt(g.tags["mtb:scale"])){case 1:d="lime";break;case 2:d="yellow";break;case 3:d="orange";break;case 4:d="red";break;case 5:d="purple";break;case 6:d="purple";break}i.setLineDash([]),i.lineWidth=6,i.strokeStyle=d,i.stroke()}i.setLineDash([15,5]),i.lineWidth=2,i.strokeStyle="black",i.stroke()}else i.setLineDash([]),i.lineWidth=3,i.strokeStyle="black",i.stroke()}}y(void 0,l)})}),l}});new A().addTo(r);const D=[62.24452234218559,25.748742842059354];L.circle(D,{radius:150*1e3,fill:!1}).addTo(r),r.setView(L.latLng(62.20999108080592,25.68709194660187),17)}),[]}class ge extends X{constructor(r){super(),Q(this,r,re,ie,Z,{})}}export{ge as default,de as prerender};
