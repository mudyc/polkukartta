import{S as J,i as Q,s as Z,e as N,k as $,t as q,K as j,c as R,d as G,m as W,a as O,h as z,b as A,L as x,J as P,g as D,n as I,w as ee}from"../chunks/index-22e9cf07.js";function H(a,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=a,r}function te(a,t,n){if(n===void 0&&(n={}),!a)throw new Error("coordinates is required");if(!Array.isArray(a))throw new Error("coordinates must be an Array");if(a.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!F(a[0])||!F(a[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:a};return H(r,t,n)}function ae(a,t,n){n===void 0&&(n={});for(var r=0,f=a;r<f.length;r++){var d=f[r];if(d.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var c=0;c<d[d.length-1].length;c++)if(d[d.length-1][c]!==d[0][c])throw new Error("First and last Position are not equivalent.")}var m={type:"Polygon",coordinates:a};return H(m,t,n)}function F(a){return!isNaN(a)&&a!==null&&!Array.isArray(a)}function X(a,t,n){if(a!==null)for(var r,f,d,c,m,p,g,E=0,e=0,S,u=a.type,y=u==="FeatureCollection",i=u==="Feature",w=y?a.features.length:1,o=0;o<w;o++){g=y?a.features[o].geometry:i?a.geometry:a,S=g?g.type==="GeometryCollection":!1,m=S?g.geometries.length:1;for(var s=0;s<m;s++){var b=0,h=0;if(c=S?g.geometries[s]:g,c!==null){p=c.coordinates;var l=c.type;switch(E=n&&(l==="Polygon"||l==="MultiPolygon")?1:0,l){case null:break;case"Point":if(t(p,e,o,b,h)===!1)return!1;e++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<p.length;r++){if(t(p[r],e,o,b,h)===!1)return!1;e++,l==="MultiPoint"&&b++}l==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<p.length;r++){for(f=0;f<p[r].length-E;f++){if(t(p[r][f],e,o,b,h)===!1)return!1;e++}l==="MultiLineString"&&b++,l==="Polygon"&&h++}l==="Polygon"&&b++;break;case"MultiPolygon":for(r=0;r<p.length;r++){for(h=0,f=0;f<p[r].length;f++){for(d=0;d<p[r][f].length-E;d++){if(t(p[r][f][d],e,o,b,h)===!1)return!1;e++}h++}b++}break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(X(c.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Y(a){var t=[1/0,1/0,-1/0,-1/0];return X(a,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}Y.default=Y;function re(a){if(!a)throw new Error("coord is required");if(!Array.isArray(a)){if(a.type==="Feature"&&a.geometry!==null&&a.geometry.type==="Point")return a.geometry.coordinates;if(a.type==="Point")return a.coordinates}if(Array.isArray(a)&&a.length>=2&&!Array.isArray(a[0])&&!Array.isArray(a[1]))return a;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function se(a){return a.type==="Feature"?a.geometry:a}function ne(a,t,n){if(n===void 0&&(n={}),!a)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=re(a),f=se(t),d=f.type,c=t.bbox,m=f.coordinates;if(c&&le(r,c)===!1)return!1;d==="Polygon"&&(m=[m]);for(var p=!1,g=0;g<m.length&&!p;g++)if(K(r,m[g][0],n.ignoreBoundary)){for(var E=!1,e=1;e<m[g].length&&!E;)K(r,m[g][e],!n.ignoreBoundary)&&(E=!0),e++;E||(p=!0)}return p}function K(a,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var f=0,d=t.length-1;f<t.length;d=f++){var c=t[f][0],m=t[f][1],p=t[d][0],g=t[d][1],E=a[1]*(c-p)+m*(p-a[0])+g*(a[0]-c)===0&&(c-a[0])*(p-a[0])<=0&&(m-a[1])*(g-a[1])<=0;if(E)return!n;var e=m>a[1]!=g>a[1]&&a[0]<(p-c)*(a[1]-m)/(g-m)+c;e&&(r=!r)}return r}function le(a,t){return t[0]<=a[0]&&t[1]<=a[1]&&t[2]>=a[0]&&t[3]>=a[1]}function ie(a){let t,n,r,f,d,c,m,p,g,E,e,S,u,y,i,w,o,s,b,h;return{c(){t=N("meta"),n=$(),r=N("section"),f=N("h1"),d=N("span"),c=N("picture"),m=N("source"),p=$(),g=N("img"),e=q(`

		to your new`),S=N("br"),u=q("SvelteKit app"),y=$(),i=N("h2"),w=q("try editing "),o=N("strong"),s=q("src/routes/index.svelte"),b=$(),h=N("div"),this.h()},l(l){const _=j('[data-svelte="svelte-t32ptj"]',document.head);t=R(_,"META",{name:!0,content:!0}),_.forEach(G),n=W(l),r=R(l,"SECTION",{class:!0});var k=O(r);f=R(k,"H1",{class:!0});var v=O(f);d=R(v,"SPAN",{class:!0});var T=O(d);c=R(T,"PICTURE",{});var M=O(c);m=R(M,"SOURCE",{srcset:!0,type:!0}),p=W(M),g=R(M,"IMG",{src:!0,alt:!0,class:!0}),M.forEach(G),T.forEach(G),e=z(v,`

		to your new`),S=R(v,"BR",{}),u=z(v,"SvelteKit app"),v.forEach(G),y=W(k),i=R(k,"H2",{});var C=O(i);w=z(C,"try editing "),o=R(C,"STRONG",{});var B=O(o);s=z(B,"src/routes/index.svelte"),B.forEach(G),C.forEach(G),k.forEach(G),b=W(l),h=R(l,"DIV",{id:!0,class:!0}),O(h).forEach(G),this.h()},h(){document.title="Home",A(t,"name","description"),A(t,"content","Svelte demo app"),A(m,"srcset","svelte-welcome.webp"),A(m,"type","image/webp"),x(g.src,E="svelte-welcome.png")||A(g,"src",E),A(g,"alt","Welcome"),A(g,"class","svelte-1na84fd"),A(d,"class","welcome svelte-1na84fd"),A(f,"class","svelte-1na84fd"),A(r,"class","svelte-1na84fd"),A(h,"id","mapid"),A(h,"class","svelte-1na84fd")},m(l,_){P(document.head,t),D(l,n,_),D(l,r,_),P(r,f),P(f,d),P(d,c),P(c,m),P(c,p),P(c,g),P(f,e),P(f,S),P(f,u),P(r,y),P(r,i),P(i,w),P(i,o),P(o,s),D(l,b,_),D(l,h,_)},p:I,i:I,o:I,d(l){G(t),l&&G(n),l&&G(r),l&&G(b),l&&G(h)}}}const he=!0;function oe(a){let t;return ee(async()=>{t=L.map("mapid").setView([65.33,26.818],176),L.tileLayer("https://tiles.kartat.kapsi.fi/peruskartta/{z}/{x}/{y}.jpg",{attribution:"&copy; MML"}).addTo(t),L.tileLayer("//tile.waymarkedtrails.org/hiking/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://waymarkedtrails.org">Waymarked Trails</a>'}).addTo(t);let n=null;const r=.016,f=.016,d=L.GridLayer.extend({renderSoil(e,S,u,y,i){switch(e.fillStyle="magenta",S){case 1:switch(e.fillStyle="LimeGreen",u){case 1:e.fillStyle="LimeGreen";break;case 2:e.fillStyle="MediumSeaGreen";break;case 3:e.fillStyle="DarkSeaGreen";break;case 4:e.fillStyle="YellowGreen";break;case 5:e.fillStyle="DarkKhaki";break}break;case 2:e.fillStyle="orange";break;case 3:e.fillStyle="brown";break;case 4:break;case 5:break;case 6:e.fillStyle="yellow";break;case 7:break;case 8:e.fillStyle="blue";break}i&&(e.fillStyle="yellow"),e.fill()},renderTrees(e,S,u,y){console.log("render trees",y.length);const i=S,w=i.getEast()-i.getWest(),o=i.getNorth()-i.getSouth();for(const s of y){const b=s.pt,h=(b[0]-i.getWest())/w*u.x,l=u.y-(b[1]-i.getSouth())/o*u.y;switch(e.beginPath(),e.moveTo(h-Math.max(s.height/7,1),l),e.lineTo(h,l-Math.max(s.height,3)),e.lineTo(h+Math.max(s.height/7,1),l),e.closePath(),e.fillStyle="brown",e.fill(),s.specie){case 1:e.beginPath(),e.arc(h,l-s.height*.7,s.height/2,Math.PI*.8,Math.PI*.2),e.closePath(),e.fillStyle="ForestGreen",e.fill();break;case 2:e.beginPath(),e.moveTo(h-s.height/3,l-2),e.lineTo(h,l-s.height),e.lineTo(h+s.height/3,l-2),e.closePath(),e.fillStyle="ForestGreen",e.fill();break;case 3:case 4:e.fillStyle="LightYellow",e.fill(),e.beginPath(),e.arc(h,l-s.height*1,s.height/3,Math.PI*.85,Math.PI*.15),e.arc(h,l-s.height*.6,s.height/2.5,Math.PI*.85,Math.PI*.15),e.closePath(),e.fillStyle="GreenYellow",e.fill();break;case 5:e.fillStyle="DarkGray",e.fill(),e.beginPath(),e.arc(h,l-s.height*1,s.height/3,Math.PI*.85,Math.PI*.15),e.arc(h,l-s.height*.6,s.height/2.5,Math.PI*.85,Math.PI*.15),e.closePath(),e.fillStyle="DarkGreen",e.fill();break;case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:default:console.log("missing render tree render for ",s.specie)}}},addTrees(e,S){const u=e.properties,y=ae(e.geometry.coordinates,e.properties),i=u.STEMCOUNT>0?Math.sqrt(u.AREA/u.STEMCOUNT):1e4;e.freq=i;const w=Y(y);let o={x:w[1],y:w[2]};for(;o.y>w[0];){const s=te([o.y,o.x]);ne(s,y)&&S.push({pt:s.geometry.coordinates,height:u.MEANHEIGHT,specie:u.MAINTREESPECIES}),o.x+=i*r,o.x>w[3]&&(o.y-=i*f,o.x-=w[3]-[w[1]])}},createTile(e,S){const u=[],y=L.DomUtil.create("canvas","leaflet-tile"),i=this.getTileSize();y.width=i.x,y.height=i.y;const w=t.unproject(e.scaleBy(i),e.z),o=t.unproject(e.clone().add([1,1]).scaleBy(i),e.z),s=L.latLngBounds(w,o),b=s.getEast()-s.getWest(),h=s.getNorth()-s.getSouth();return fetch(`https://rajapinnat.metsaan.fi/geoserver/Avoinmetsatieto/stand/wfs?SERVICE=WFS&REQUEST=GetFeature&VERSION=2.0.0&TYPENAMES=Avoinmetsatieto:stand&STARTINDEX=0&COUNT=10000&SRSNAME=urn:ogc:def:crs:EPSG::4326&BBOX=${s.getSouth()},${s.getWest()},${s.getNorth()},${s.getEast()},urn:ogc:def:crs:EPSG::4326&outputFormat=json`).then(_=>{_.json().then(k=>{const v=y.getContext("2d");v.clearRect(0,0,y.width,y.height);for(const T of k.features){this.addTrees(T,u),v.beginPath();for(let C=0;C<T.geometry.coordinates[0].length;C++){const B=T.geometry.coordinates[0][C],U=(B[0]-s.getWest())/b*i.x,V=i.y-(B[1]-s.getSouth())/h*i.y;C==0?v.moveTo(U,V):v.lineTo(U,V)}v.closePath();const M=T.properties;this.renderSoil(v,M.MAINGROUP,M.SUBGROUP,M.SOILTYPE,T==n),v.lineWidth=.3,v.strokeStyle="black",v.stroke()}this.renderTrees(v,s,i,u),S(void 0,y)})}),y}});new d().addTo(t);const m=L.GridLayer.extend({id2way:{},createTile(e,S){const u=L.DomUtil.create("canvas","leaflet-tile"),y=this.getTileSize();u.width=y.x,u.height=y.y;const i=t.unproject(e.scaleBy(y),e.z),w=t.unproject(e.clone().add([1,1]).scaleBy(y),e.z),o=L.latLngBounds(i,w),s=o.getEast()-o.getWest(),b=o.getNorth()-o.getSouth();return fetch(`https://overpass.kumi.systems/api/interpreter?data=[out:json][bbox:${w.lat},${i.lng},${i.lat},${w.lng}];way[highway];out geom;`).then(l=>{l.json().then(_=>{for(const v of _.elements){const T=v.id;this.id2way[T]===void 0&&(this.id2way[T]=v)}const k=u.getContext("2d");k.clearRect(0,0,u.width,u.height);for(const v of Object.values(this.id2way)){const T=L.latLngBounds(L.latLng(v.bounds.minlat,v.bounds.minlon),L.latLng(v.bounds.maxlat,v.bounds.maxlon));if(o.overlaps(T)){for(let M=0;M<v.geometry.length;M++){const C=v.geometry[M],B=(C.lon-o.getWest())/s*y.x,U=y.y-(C.lat-o.getSouth())/b*y.y;M==0?k.moveTo(B,U):k.lineTo(B,U)}k.lineWidth=5,k.strokeStyle="red",k.stroke()}}S(void 0,u)})}),u}});new m().addTo(t);const g=[62.24452234218559,25.748742842059354];L.circle(g,{radius:150*1e3,fill:!1}).addTo(t),t.setView(L.latLng(62.20999108080592,25.68709194660187),17)}),[]}class ce extends J{constructor(t){super(),Q(this,t,oe,ie,Z,{})}}export{ce as default,he as prerender};
