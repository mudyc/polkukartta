import{S as J,i as Q,s as j,e as k,k as N,t as R,K as x,c as M,d as S,m as U,a as z,h as D,b as E,L as ee,J as _,g as q,n as F,w as te}from"../chunks/index-22e9cf07.js";function X(e,t,r){r===void 0&&(r={});var s={type:"Feature"};return(r.id===0||r.id)&&(s.id=r.id),r.bbox&&(s.bbox=r.bbox),s.properties=t||{},s.geometry=e,s}function I(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!V(e[0])||!V(e[1]))throw new Error("coordinates must contain numbers");var s={type:"Point",coordinates:e};return X(s,t,r)}function $(e,t,r){r===void 0&&(r={});for(var s=0,l=e;s<l.length;s++){var d=l[s];if(d.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<d[d.length-1].length;u++)if(d[d.length-1][u]!==d[0][u])throw new Error("First and last Position are not equivalent.")}var y={type:"Polygon",coordinates:e};return X(y,t,r)}function V(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function H(e,t,r){if(e!==null)for(var s,l,d,u,y,g,v,b=0,p=0,P,A=e.type,G=A==="FeatureCollection",a=A==="Feature",f=G?e.features.length:1,n=0;n<f;n++){v=G?e.features[n].geometry:a?e.geometry:e,P=v?v.type==="GeometryCollection":!1,y=P?v.geometries.length:1;for(var c=0;c<y;c++){var o=0,i=0;if(u=P?v.geometries[c]:v,u!==null){g=u.coordinates;var h=u.type;switch(b=r&&(h==="Polygon"||h==="MultiPolygon")?1:0,h){case null:break;case"Point":if(t(g,p,n,o,i)===!1)return!1;p++,o++;break;case"LineString":case"MultiPoint":for(s=0;s<g.length;s++){if(t(g[s],p,n,o,i)===!1)return!1;p++,h==="MultiPoint"&&o++}h==="LineString"&&o++;break;case"Polygon":case"MultiLineString":for(s=0;s<g.length;s++){for(l=0;l<g[s].length-b;l++){if(t(g[s][l],p,n,o,i)===!1)return!1;p++}h==="MultiLineString"&&o++,h==="Polygon"&&i++}h==="Polygon"&&o++;break;case"MultiPolygon":for(s=0;s<g.length;s++){for(i=0,l=0;l<g[s].length;l++){for(d=0;d<g[s][l].length-b;d++){if(t(g[s][l][d],p,n,o,i)===!1)return!1;p++}i++}o++}break;case"GeometryCollection":for(s=0;s<u.geometries.length;s++)if(H(u.geometries[s],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function W(e){var t=[1/0,1/0,-1/0,-1/0];return H(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}W.default=W;function ae(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function se(e){return e.type==="Feature"?e.geometry:e}function Z(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var s=ae(e),l=se(t),d=l.type,u=t.bbox,y=l.coordinates;if(u&&re(s,u)===!1)return!1;d==="Polygon"&&(y=[y]);for(var g=!1,v=0;v<y.length&&!g;v++)if(K(s,y[v][0],r.ignoreBoundary)){for(var b=!1,p=1;p<y[v].length&&!b;)K(s,y[v][p],!r.ignoreBoundary)&&(b=!0),p++;b||(g=!0)}return g}function K(e,t,r){var s=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var l=0,d=t.length-1;l<t.length;d=l++){var u=t[l][0],y=t[l][1],g=t[d][0],v=t[d][1],b=e[1]*(u-g)+y*(g-e[0])+v*(e[0]-u)===0&&(u-e[0])*(g-e[0])<=0&&(y-e[1])*(v-e[1])<=0;if(b)return!r;var p=y>e[1]!=v>e[1]&&e[0]<(g-u)*(e[1]-y)/(v-y)+u;p&&(s=!s)}return s}function re(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function ie(e){let t,r,s,l,d,u,y,g,v,b,p,P,A,G,a,f,n,c,o,i;return{c(){t=k("meta"),r=N(),s=k("section"),l=k("h1"),d=k("span"),u=k("picture"),y=k("source"),g=N(),v=k("img"),p=R(`

		to your new`),P=k("br"),A=R("SvelteKit app"),G=N(),a=k("h2"),f=R("try editing "),n=k("strong"),c=R("src/routes/index.svelte"),o=N(),i=k("div"),this.h()},l(h){const m=x('[data-svelte="svelte-t32ptj"]',document.head);t=M(m,"META",{name:!0,content:!0}),m.forEach(S),r=U(h),s=M(h,"SECTION",{class:!0});var w=z(s);l=M(w,"H1",{class:!0});var T=z(l);d=M(T,"SPAN",{class:!0});var C=z(d);u=M(C,"PICTURE",{});var O=z(u);y=M(O,"SOURCE",{srcset:!0,type:!0}),g=U(O),v=M(O,"IMG",{src:!0,alt:!0,class:!0}),O.forEach(S),C.forEach(S),p=D(T,`

		to your new`),P=M(T,"BR",{}),A=D(T,"SvelteKit app"),T.forEach(S),G=U(w),a=M(w,"H2",{});var B=z(a);f=D(B,"try editing "),n=M(B,"STRONG",{});var Y=z(n);c=D(Y,"src/routes/index.svelte"),Y.forEach(S),B.forEach(S),w.forEach(S),o=U(h),i=M(h,"DIV",{id:!0,class:!0}),z(i).forEach(S),this.h()},h(){document.title="Home",E(t,"name","description"),E(t,"content","Svelte demo app"),E(y,"srcset","svelte-welcome.webp"),E(y,"type","image/webp"),ee(v.src,b="svelte-welcome.png")||E(v,"src",b),E(v,"alt","Welcome"),E(v,"class","svelte-1na84fd"),E(d,"class","welcome svelte-1na84fd"),E(l,"class","svelte-1na84fd"),E(s,"class","svelte-1na84fd"),E(i,"id","mapid"),E(i,"class","svelte-1na84fd")},m(h,m){_(document.head,t),q(h,r,m),q(h,s,m),_(s,l),_(l,d),_(d,u),_(u,y),_(u,g),_(u,v),_(l,p),_(l,P),_(l,A),_(s,G),_(s,a),_(a,f),_(a,n),_(n,c),q(h,o,m),q(h,i,m)},p:F,i:F,o:F,d(h){S(t),h&&S(r),h&&S(s),h&&S(o),h&&S(i)}}}const he=!0;function ne(){L.CanvasOverlay=L.Layer.extend({initialize(e,t){this._userDrawFunc=e,L.setOptions(this,t)},drawing(e){return this._userDrawFunc=e,this},params(e){return L.setOptions(this,e),this},canvas(){return this._canvas},redraw(){return this._frame||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd(e){this._map=e,this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer");var t=this._map.getSize();this._canvas.width=t.x,this._canvas.height=t.y;var r=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(r?"animated":"hide")),e._panes.overlayPane.appendChild(this._canvas),e.on("moveend",this._reset,this),e.on("resize",this._resize,this),e.options.zoomAnimation&&L.Browser.any3d&&e.on("zoomanim",this._animateZoom,this),this._reset()},onRemove(e){e.getPanes().overlayPane.removeChild(this._canvas),e.off("moveend",this._reset,this),e.off("resize",this._resize,this),e.options.zoomAnimation&&e.off("zoomanim",this._animateZoom,this),this_canvas=null},addTo(e){return e.addLayer(this),this},addEventListener(e,t){this._canvas.addEventListener(e,t,!1)},_resize(e){this._canvas.width=e.newSize.x,this._canvas.height=e.newSize.y},_reset(){var e=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,e),this._redraw()},_redraw(){console.log("redraw");var e=this._map.getSize(),t=this._map.getBounds(),r=e.x*180/(2003750834e-2*(t.getEast()-t.getWest())),s=this._map.getZoom();this._userDrawFunc&&this._userDrawFunc(this,{canvas:this._canvas,bounds:t,size:e,zoomScale:r,zoom:s,options:this.options}),this._frame=null},_animateZoom(e){var t=this._map.getZoomScale(e.zoom);this._map._getCenterOffset(e.center)._multiplyBy(-t).subtract(this._map._getMapPanePos())}}),L.canvasOverlay=function(e,t){return new L.CanvasOverlay(e,t)}}function oe(e){let t;return te(async()=>{ne(),t=L.map("mapid").setView([65.33,26.818],176),L.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t),L.tileLayer("https://tiles.kartat.kapsi.fi/peruskartta/{z}/{x}/{y}.jpg",{attribution:"&copy; MML"}).addTo(t),L.tileLayer("//tile.waymarkedtrails.org/hiking/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://waymarkedtrails.org">Waymarked Trails</a>'}).addTo(t);const r={},s=[];let l=null;const d=(a,f,n,c,o)=>{switch(a.fillStyle="magenta",f){case 1:switch(a.fillStyle="LimeGreen",n){case 1:a.fillStyle="LimeGreen";break;case 2:a.fillStyle="MediumSeaGreen";break;case 3:a.fillStyle="DarkSeaGreen";break;case 4:a.fillStyle="YellowGreen";break;case 5:a.fillStyle="DarkKhaki";break}break;case 2:a.fillStyle="orange";break;case 3:a.fillStyle="brown";break;case 4:break;case 5:break;case 6:a.fillStyle="yellow";break;case 7:break;case 8:a.fillStyle="blue";break}o&&(a.fillStyle="yellow"),a.fill()},u=.016,y=.016,g=(a,f)=>{console.log("render trees",s.length);const n=f.bounds,c=n.getEast()-n.getWest(),o=n.getNorth()-n.getSouth();for(const i of s){const h=i.pt,m=(h[0]-n.getWest())/c*f.canvas.width,w=f.canvas.height-(h[1]-n.getSouth())/o*f.canvas.height;switch(a.beginPath(),a.moveTo(m-Math.max(i.height/7,1),w),a.lineTo(m,w-Math.max(i.height,3)),a.lineTo(m+Math.max(i.height/7,1),w),a.closePath(),a.fillStyle="brown",a.fill(),i.specie){case 1:a.beginPath(),a.arc(m,w-i.height*.7,i.height/2,Math.PI*.8,Math.PI*.2),a.closePath(),a.fillStyle="ForestGreen",a.fill();break;case 2:a.beginPath(),a.moveTo(m-i.height/3,w-2),a.lineTo(m,w-i.height),a.lineTo(m+i.height/3,w-2),a.closePath(),a.fillStyle="ForestGreen",a.fill();break;case 3:case 4:a.fillStyle="LightYellow",a.fill(),a.beginPath(),a.arc(m,w-i.height*1,i.height/3,Math.PI*.85,Math.PI*.15),a.arc(m,w-i.height*.6,i.height/2.5,Math.PI*.85,Math.PI*.15),a.closePath(),a.fillStyle="GreenYellow",a.fill();break;case 5:a.fillStyle="DarkGray",a.fill(),a.beginPath(),a.arc(m,w-i.height*1,i.height/3,Math.PI*.85,Math.PI*.15),a.arc(m,w-i.height*.6,i.height/2.5,Math.PI*.85,Math.PI*.15),a.closePath(),a.fillStyle="DarkGreen",a.fill();break;case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:default:console.log("missing render tree render for ",i.specie)}}},v=(a,f)=>{const n=f.bounds;p(f.bounds);const c=f.canvas.getContext("2d");c.clearRect(0,0,f.canvas.width,f.canvas.height);const o=n.getEast()-n.getWest(),i=n.getNorth()-n.getSouth();for(const h of Object.values(r)){c.beginPath();for(let w=0;w<h.geometry.coordinates[0].length;w++){const T=h.geometry.coordinates[0][w],C=(T[0]-n.getWest())/o*f.canvas.width,O=f.canvas.height-(T[1]-n.getSouth())/i*f.canvas.height;w==0?c.moveTo(C,O):c.lineTo(C,O)}c.closePath();const m=h.properties;d(c,m.MAINGROUP,m.SUBGROUP,m.SOILTYPE,h==l),c.lineWidth=.3,c.strokeStyle="black",c.stroke()}g(c,f)},b=a=>{console.log("add trees");const f=a.properties,n=$(a.geometry.coordinates,a.properties),c=f.STEMCOUNT>0?Math.sqrt(f.AREA/f.STEMCOUNT):1e4;a.freq=c;const o=W(n);let i={x:o[1],y:o[2]};for(;i.y>o[0];){const h=I([i.y,i.x]);Z(h,n)&&s.push({pt:h.geometry.coordinates,height:f.MEANHEIGHT,specie:f.MAINTREESPECIES}),i.x+=c*u,i.x>o[3]&&(i.y-=c*y,i.x-=o[3]-[o[1]])}},p=a=>{fetch(`https://rajapinnat.metsaan.fi/geoserver/Avoinmetsatieto/stand/wfs?SERVICE=WFS&REQUEST=GetFeature&VERSION=2.0.0&TYPENAMES=Avoinmetsatieto:stand&STARTINDEX=0&COUNT=10000&SRSNAME=urn:ogc:def:crs:EPSG::4326&BBOX=${a.getSouth()},${a.getWest()},${a.getNorth()},${a.getEast()},urn:ogc:def:crs:EPSG::4326&outputFormat=json`).then(f=>{f.json().then(n=>{let c=!1;for(const o of n.features)!c&&s.length<1e3&&r[o.id]===void 0&&(c=!0,r[o.id]=o,b(o));console.log(n),c&&P.redraw()})})},P=L.canvasOverlay();P.drawing(v).addTo(t),P.addEventListener("click",a=>{const f=t.layerPointToLatLng(L.point(a.offsetX,a.offsetY));for(const n of Object.values(r)){const c=$(n.geometry.coordinates,n.properties),o=I([f.lng,f.lat]);Z(o,c)&&(l=l==n?null:n,console.log(n),P.redraw())}});const A=[62.24452234218559,25.748742842059354];L.circle(A,{radius:150*1e3,fill:!1}).addTo(t),t.setView(L.latLng(62.20999108080592,25.68709194660187),17)}),[]}class fe extends J{constructor(t){super(),Q(this,t,oe,ie,j,{})}}export{fe as default,he as prerender};
